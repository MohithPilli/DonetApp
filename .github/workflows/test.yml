name:  workflow
on: 
 push: 
  branches: ["master"]

jobs:
  
  Build:  
    runs-on: ubuntu-latest

    steps:

    - name: checkout repository
      uses: actions/checkout@v3

    - name: show settings.json
      run: cat settings.json
      shell: bash

       # Step 3: Update JSON File with Secrets Dynamically
    - name: Update JSON File with Secrets
      # env:
      #  key1: ${{ secrets.color }}
      #  key2: ${{ secrets.key }}
      run: |
         # Define the JSON file path
         JSON_FILE="./settings.json"
         # Read all keys from the JSON file
         echo "Reading keys from JSON file..."
         KEYS=$(jq -r 'keys[]' $JSON_FILE)
         echo "Keys found in JSON file: $KEYS"
         # Iterate over the keys and update their values from environment variables
         for KEY in $KEYS; do
           $KEY: ${{ SECRETS.$KEY }}
           echo "Processing key: $KEY"
           SECRET_VALUE=$(printenv "$KEY")
           echo "$SECRET_VALUE"
           if [[ -n "$SECRET_VALUE" ]]; then
             echo "Updating key $KEY with value from environment secret."
             jq --arg key "$KEY" --arg value "$SECRET_VALUE" \
               '.[$key] = $value' $JSON_FILE > temp.json && mv temp.json $JSON_FILE
           else
             echo "No environment secret found for key: $KEY. Skipping update."
           fi
         done
         # Print the updated JSON file for verification
         echo "Updated JSON file content:"
         cat $JSON_FILE
      shell: bash
      
